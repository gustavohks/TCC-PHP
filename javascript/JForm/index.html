<html>
    <head>
        <title>Form Builder</title>
        <script type="text/javascript" src="test.js"></script>

        <!-- <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script> -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="css/codemirror.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link href="css/form_builder.css" rel="stylesheet">
        <link href="css/css-custom.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/jquery-ui.min.js"></script>
        <!-- <link rel='stylesheet' href='http://css-tricks.com/examples/ViewSourceButton/css/style.css' /> -->
        <link rel='stylesheet' href='http://css-tricks.com/examples/ViewSourceButton/css/prettify.css' />
        <script src="js/prettify.js"></script>
        <style>
          #source {background: rgba(0,0,0,0.8);}
          .fonte {margin: 10px; }
          #content {padding: 40px;padding-top: 20px;}
          #tabcontent { background: rgba(0,0,0,0.8);}
          #source:target { display: block; }
          #source pre { font: 12px/1.6 Monaco, Courier, MonoSpace;  color: white; overflow: auto; }
          #source pre a, #source pre a span { text-decoration: none; color: #00ccff !important; }
        </style>
    </head>
    <body>
        <div class="row-fluid" style="overflow: hidden">
            <div class="container">
                <div class="row">
                    <div class="col-9">
                        <h1>JForm</h1>
                        <hr>
                        <div class="tab">
                                <button class="tablinks" id="defaultOpen" onclick="openTab(event, 'content') ">Editor</button>
                                <button class="tablinks" onclick="openTab(event, 'fonte')">Source</button>
                                <!-- <li><a href="#source-tab" data-toggle="tab"  id="sourcetab">Source</a></li>                                 -->
                        </div>
                                <!-- Tab content -->

                                    <div id="content" class="tabcontent"> 
                                          <div class = "row form-horizontal ui-droppable ui-sortable" id="forma"><div class = "col-12"><h3>Formulário</h3></div></div>
                                    </div>
                                <div id="fonte" class="tabcontentSource">
                                    <div class="source" id="source"></div>
                                </div>                        
                    </div>

                    <div class="col-md-3 col-sm-12" >
                        <h1>Botões</h1>
                        <hr>
                        <div id="components-container" >
                            <div class="control-group component" data-type="text">
                                <button id="addText" class="btn btn-primary" style="width: 235px; height: 50px; font-size : 16px;"><i class="fa fa-indent" aria-hidden="true"></i> Add text</button>
                            </div>
                            <div class="control-group component">
                                <button id="addCheckbox" class="btn btn-primary" style="width: 235px; height: 50px; font-size : 16px;"><i class="fa fa-check-square-o" aria-hidden="true"></i> Add checkbox</button>
                            </div>
                            <div class="control-group component">
                                    <button id="addRadio" class="btn btn-primary" style="width: 235px; height: 50px; font-size : 16px;"><i class="fa fa-circle-o" aria-hidden="true"></i> Add radio</button>
                            </div>
                            <div class="control-group component">
                                    <button id="addSubmit" class="btn btn-primary" style="width: 235px; height: 50px; font-size : 16px;"><i class="fa fa-send-o"></i> Add submit</button>
                            </div>                          
                            <div class="control-group component">
                                    <button id="addReset" class="btn btn-primary" style="width: 235px; height: 50px; font-size : 16px;"><i class="fa fa-refresh"></i> Add reset</button>
                            </div>
                            <div class="form-actions component" data-type="submit">
                                <input class="btn btn-danger"  type="button" value="Refresh Page" onClick="window.location.reload()" style="width: 235px; height: 50px; font-size : 16px;">
                                <!-- <input class="btn btn-info"  type="button" id="copyHTML" value="Copy HTML" style="width: 100%; height: 33px; font-size : 16px; margin-top: 10px;"> -->
                                <!-- data-toggle="modal" data-target="#modalCopyHTML" -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        </div>
      
  <!-- Modal -->
  <div class="modal fade" id="modalText" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Editar</h4>
        </div>
        <div class="modal-body">
          <p>Label:</p>
          <p> <input type="text" name="fetchLabelText" id="fetchLabelText" value=""  style="height: 30px; width:300px"></p>             
          <p>Type:</p>
          <p><select name="fetchTypeText" id="fetchTypeText"" style="height: 30px; width:300px">
            <option label="Text Field" value="text">Text Field</option>
            <option label="Password" value="password">Password</option>
            <option label="Email" value="email">Email</option>
          </select></p>             
          <p>Required:</p>
          <p><select name="fetchRequiredText" id="fetchRequiredText"" style="height: 30px; width:300px">
            <option label="Sim" value="sim">Sim</option>
            <option label="Nao" value="nao">Não</option>
          </select></p>          
          <p>Placeholder:</p>
          <p> <input type="text" name="fetchPlaceholderText" id="fetchPlaceholderText" value=""  style="height: 30px; width:300px"></p>          
          <p>Name:</p>
          <p> <input type="text" name="fetchNameText" id="fetchNameText" value=""  style="height: 30px; width:300px"></p>          
          <p>Width:</p>
          <p> <input type="text" name="fetchWidthText" id="fetchWidthText" value=""  style="height: 30px; width:300px"></p>            
          <p>Div Size:</p>
          <p> <input type="text" name="fetchDivText" id="fetchDivText" value=""  style="height: 30px; width:300px"></p>                    
          <p>ID:</p>
          <p> <input type="text" name="fetchIdText" id="fetchIdText" value="" ><input type="hidden" id="fetchHidden" value=""/></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="salvar btn btn-success" data-dismiss="modal" name="salvarText" id="salvarText" value="">Save</button>
          <button type="button" class="fechar btn btn-danger" data-dismiss="modal" value="">Close</button>
        </div>
      </div>
      
    </div>
  </div> 

    <!-- Modal -->
  <div class="modal fade" id="modalCopyHTML" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Source</h4>
        </div>
        <div class="modal-body">
          <div class = "row form-horizontal ui-droppable ui-sortable" id="formaHTML"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="fechar btn btn-danger" data-dismiss="modal" value="">Close</button>
        </div>
      </div>
      
    </div>
  </div>

</div>

<script type="text/javascript">

$('.btn').mouseup(function() { this.blur() })

function openTab(evt, nome) {
    var i, tabcontent, tabcontentSource,  tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    tabcontentSource = document.getElementsByClassName("tabcontentSource");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    for (i = 0; i < tabcontentSource.length; i++) {
        tabcontentSource[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(nome).style.display = "block";
    evt.currentTarget.className += " active";

}
    document.getElementById("defaultOpen").click();

// function updateSource() {
// $('#source').load(document.URL +  ' #source');
// }
// function updateSource(){
//      var content = $("#source").html();
//      source.setValue(this.cleanContent(content));
//      // source.autoFormatRange(
//      //   { line: 0, ch: 0 },
//      //   { line: source.lastLine()+1, ch: 0 }
//      // );
// }; 

//     function cleanContent(content) {
//      return $("#source")
//          .replace(/\t/, '')
//          .replace(/ ui-draggable| element/gi, '')
//          .replace(/col-4/g, 'lol')
//          .replace(/ data-(.+)="(.+)"/g, '');
//     };

// function copyToClipboard(text) {

//    var textArea = document.createElement( "textarea" );
//    textArea.value = text;
//    document.body.appendChild( textArea );

//    textArea.select();

//    try {
//       var successful = document.execCommand( 'copy' );
//       var msg = successful ? 'successful' : 'unsuccessful';
//       alert('Copying text command was ' + msg);
//    } catch (err) {
//       alert('Oops, unable to copy');
//    }

//    document.body.removeChild( textArea );
// }

// $('#copyHTML').click( function()
//  {
//  });

// $(document).ready(function(){
//     $("#copyHTML").click(function(){
//      var clipboardText = "";
//      clipboardText = $('#source').html();
//      copyToClipboard(clipboardText);
//     });
// });


//https://css-tricks.com/make-a-view-source-button/
$(document).ready(function(){
    $('button').on('click', function(e){

        $(".space").remove();
        //atualiza o conteudo da #source
        $("#source").html("");
        $("<pre />", {
    "html":   '&lt;!DOCTYPE html>\n&lt;html>\n&lt;head>\n\t&ltlink href="css/bootstrap.min.css" rel="stylesheet">\n\t&ltlink href="css/bootstrap-responsive.min.css" rel="stylesheet">\n\t&ltlink href="css/css-custom.css" rel="stylesheet">\n&lt;/head>\n&lt;form method="POST" action="" class="form-horizontal">\n  &ltdiv class="container">\n    &ltdiv class="row">\n\t' + 
        $("#forma")
          .html()
          .replace(/[<>]/g, function(m) { return {'<':'&lt;','>':'&gt;'}[m]})
          .replace(/button id="remove(.+)\/button/g, '')
          .replace(/button data-toggle(.+)\/button/g, '')
          .replace(/hoverButton/g, '')
          .replace(/style="position: relative; left: 0px; top: 0px;"/g, '')
          .replace(/^\s*[\r\n]/gm, '')
          .replace(/&lt;&gt;/g, '')
          .replace(/((ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?)/gi,'<a href="$1">$1</a>') + 
        '\n    &lt/div>\n  &lt/div>\n&lt;/form>\n&lt;/html>',
        "class": "prettyprint"
       }).appendTo("#source");
        prettyPrint();
    });
});

  $("#forma")
  .sortable({
    placeholder: "element-placeholder",
    start: function(e, ui) {
      ui.item.popover('hide');
    }
  })
  .disableSelection();

//seleciona o primeiro item do modal
$('#modalText').on('shown.bs.modal', function () {
    $('#fetchLabelText').focus();
}) 

//atribui atalhos para salvar e fechar
var KEYCODE_ENTER = 13;
var KEYCODE_ESC = 27;
$(document).keyup(function(e) {
  if (e.keyCode == KEYCODE_ENTER) $('.salvar').click();
  if (e.keyCode == KEYCODE_ESC) $('.fechar').click();
});

//esconde os botões
$(document).ready(function () {
      $(document).on('mouseenter', '.hoverButton', function () {
          $(this).find(":button").show();
      }).on('mouseleave', '.hoverButton', function () {
          $(this).find(":button").hide();
      });
});

$(document).ready(function() {
    var forma = $('#forma');
    var i = $('#forma').length;
                   

   $(document).on('click', '#addText', function(){
            $('<div class = "space"></div>\n\t<div class="col-6 form-group hoverButton" id = divText' + i +'>\n\t\t<label id="labelText' + i +'" for="text' + i +'">Texto: </label><span id = "requiredText'+i+'" style="color:red;"></span> <button id="removeText" class=" btn btn-danger btn-sm" value="' + i + '" style="display: none;"><i class="fa fa-close"></i></button> <button data-toggle="modal" data-target="#modalText" name="editText" id="editText" class=" btn btn-primary btn-sm" value="' + i + '" style="display: none;" ><i class="fa fa-pencil"></i><input type="hidden" id="hidden' + i + '" value="' + i + '"/></button>\n\t\t<input type="text" class="form-control text' + i +'" id="text' + i +'" name="text" value="" placeholder="Digite o seu texto"/> \n\t</div>\n').appendTo(forma);
            i++;
            // updateSource();
            return false;
    }); 
       

   $(document).on('click', '#removeText', function(){
            if( i > 0 ) {
                //$(this).parent().remove();
                //i--;
                var id = $(this).attr('value');
                $('#divText'+id).fadeOut(300, function(){ 
                    $(this).remove();
                });
           }
            return false;
    });



});
    $(document).on('click', '#editText', function(){

      // impede que o form envie o post
      event.preventDefault();
      var i = $(this).attr('value');
      // var id = $(this).parent().find("input[type='hidden']").val();
      // var idLabel = $(this).parent().find("input[type='hidden']").val();

      // if (id.match(/^[0-9]+$/) != null) {
      //   id = "text" + id;
      //   idLabel = "labelText" + idLabel;
      // } else{
      //   id = id;
      //   idLabel = idLabel;
      // }
      // pega os dados de forma individual do form
      // var placeholder = $('#text'+id).val();
      var placeholderText = $('.text'+i).attr('placeholder'); 
      var nameText = $('.text'+i).attr('name'); 
      var labelText = document.getElementById('labelText'+i).textContent;
      var widthText = $('.text'+i).width();
      var idText = $('.text'+i).attr('id');
      var divText = $('#divText'+i).attr('class').replace(/col-/g, '').replace(/form-group hoverButton/g, '');
      var typeText = $('.text'+i).attr('type');
      var requiredText = $('.text'+i).attr('required');
      
      //atribui um valor para o campo com id fetchHidden
      $(fetchHidden).val(i);
      // $('#fetchPlaceholderText').attr('placeholder',placeholderText);
      $(fetchPlaceholderText).val(placeholderText);
      // $('#fetchNameText').attr('name',nameText);
      $(fetchNameText).val(nameText);
      // $('#fetchLabelText').attr('value',labelText);
      $(fetchLabelText).val(labelText);
      // $('#fetchWidthText').attr('width',widthText);
      $(fetchWidthText).val(widthText);
      // $('#fetchIdText').attr('name',idText);
      $(fetchIdText).val(idText);
      // $('#fetchDivText').attr('class',divText);
      $(fetchDivText).val(divText);
      // $('#fetchTypeText').attr('type',typeText);
      $(fetchTypeText).val(typeText);
      // $('#fetchRequiredText').attr('required',requiredText);
      if (requiredText == "required") {
      $(fetchRequiredText).val("sim");        
      } else {
      $(fetchRequiredText).val("nao");  
      }

      // $('#salvarText').attr('value',id);


    });
    var i = 0;
    $(document).on('click', '#salvarText', function(){
      var inputPlaceholderText = document.getElementById('fetchPlaceholderText');
      var inputLabelText = document.getElementById('fetchLabelText');
      var inputNameText = document.getElementById('fetchNameText');
      var inputWidthText = document.getElementById('fetchWidthText');
      var inputIdText = document.getElementById('fetchIdText');
      var inputDivText = document.getElementById('fetchDivText');
      var inputTypeText = document.getElementById('fetchTypeText');
      var inputRequiredText = document.getElementById('fetchRequiredText');
      var id = $('#fetchHidden').attr('value');
      // var id = $(this).attr('value');
      // alert(id);
      var novoPlaceholderText = inputPlaceholderText.value;
      var novoLabelText = inputLabelText.value;
      var novoNameText = inputNameText.value;
      var novoWidthText = inputWidthText.value;
      var novoIdText = inputIdText.value;
      var novoDivText = "col-" + inputDivText.value + " form-group hoverButton";
      var novoTypeText = inputTypeText.value;
      var novoRequiredText;
      

      if ((inputRequiredText.value == 'sim') && (i < 1)) {   
        novoRequiredText == "required";
        $('.text'+id).prop('required',true);
        document.getElementById('requiredText'+id).innerHTML = "*";
        i++;
      } else if ((inputRequiredText.value == 'nao') && (i > 0) ){
        novoRequiredText == "";        
        $('.text'+id).prop('required',false);
        document.getElementById('requiredText'+id).innerHTML = "";
        i--;
      }

      $('.text'+id).attr('placeholder',novoPlaceholderText);
      $('.text'+id).attr('name',novoNameText);
      $('.text'+id).attr('id',novoIdText);
      $('#divText'+id).attr('class',novoDivText);
      // $('.editText').attr('value', novoIdText);
      // $("#mainTable").css("width", "100");
      $('.text'+id).css("width",novoWidthText);
      $('.text'+id).attr("type",novoTypeText);
      document.getElementById('labelText'+id).innerHTML = novoLabelText;
    });

$(document).ready(function() {
    var forma = $('#forma');
    var i = $('#forma').length;
    
   $(document).on('click', '#addSubmit', function(){
        if (i<2) {
            $('<div class="col-4" id = divSubmit'+i+'><button class="btn btn-success" type="submit" id="submit" style="width: 120px;">Submit</button> <button id="removeSubmit" class=" btn btn-danger btn-sm" value="' + i + '"><i class="fa fa-close"></button></div>').appendTo(forma);
            i++;
            return false;
        }    
    });
    
   $(document).on('click', '#removeSubmit', function(){
                var id = $(this).attr('value');
                $('#divSubmit'+id).fadeOut(300, function(){ 
                    $(this).remove();
                });
                i--;
            return false;
    });
});

$(document).ready(function() {
    var forma = $('#forma');
    var i = $('#forma').length;
    
   $(document).on('click', '#addReset', function(){
        console.log(i);
        if (i<2) {
            $('<div class="col-4" id = divReset'+i+'><button class="btn btn-warning" type="reset" id="reset" style="width: 120px;">Reset</button> <button id="removeReset" class=" btn btn-danger btn-sm" value="' + i + '"><i class="fa fa-close"></button></div>').appendTo(forma);
            i++;
            return false;
        }
    });
    
   $(document).on('click', '#removeReset', function(){
                var id = $(this).attr('value');
                $('#divReset'+id).fadeOut(300, function(){ 
                    $(this).remove();
                });
                i--;
            return false;
    });
});

$(document).ready(function() {

  var forma = $('#forma');
  var k = $('#forma').length;
  var j = $('.inputsCheckbox').length + 1;
  var divCheckbox = $('#divCheckbox');


 $(document).on('click', '#addCheckbox', function(){

    $('<div class="col-md-4 col-12" id = divCheckbox' + k +'><a style="font-weight: bold;">Checkbox:</a> <button id="removeCheckbox" class=" btn btn-danger btn-sm" value="' + k + '"> <i class="fa fa-close"></i></button> <button id="addCheckboxInput'+ k +'" class=" addCheckboxInput btn btn-primary btn-sm" value="'+ k +'"> <i class="fa fa-plus"></i></button> <button id="removeCheckboxInput'+ k +'" class=" removeCheckboxInput btn btn-warning btn-sm" value=""> <i class="fa fa-minus"></i></button> <br> <div class = "inputsCheckbox'+ k +'" id = "inputsCheckbox' + k +'"></div></div>').appendTo(forma);
    k++;
    return false;
  });

  $(document).on('click', '.addCheckboxInput', function(){
    var idCheckbox = $(this).attr('value');
    var qtde = $('.checkbox'+idCheckbox).length + 1;
    $('<input type="checkbox" id="checkbox' + qtde +'" size="20" name="checkbox" class="checkbox'+idCheckbox+'" value="' + qtde +'" /> <a class="option'+idCheckbox+'" style="font-weight: bold;">Option ' + qtde +'<br></a>').appendTo(".inputsCheckbox"+idCheckbox);
    //$(".inputsCheckbox"+i).append('');
     //<input type=\"checkbox\" id=\"checkbox' + i +'\" size=\"20\" name=\"checkbox\" value=\"\" />
    $('#removeCheckboxInput'+idCheckbox).attr('value',idCheckbox);

    return false;
  });

  $(document).on('click', '.removeCheckboxInput', function(){
    var idCheckbox = $(this).attr('value');
    var qtde = $('.checkbox'+idCheckbox).length;
    $('.checkbox'+idCheckbox).last().remove();
    $('.option'+idCheckbox).last().remove();
    return false;
  });
        
  $(document).on('click', '#removeCheckbox', function(){
    if( k > 0 ) {
        //$(this).parent().remove();
        //i--;
        var id = $(this).attr('value');
        $('#divCheckbox'+id).fadeOut(300, function(){ 
            $(this).remove();
        });
   }
    return false;
  });    

});



$(document).ready(function() {

    var forma = $('#forma');
    var k = $('#forma').length;
    var j = $('.inputsRadio').length + 1;
    var divRadio = $('#divRadio'); 


   $(document).on('click', '#addRadio', function(){
             $('<div class="col-md-4 col-12" style="padding-top: 10px; padding-left: 10px;" id = divRadio' + k +'><a style="font-weight: bold;">Radio: <button id="removeRadio" class=" btn btn-danger btn-sm" value="' + k + '"> <i class="fa fa-close"></i></button> <button id="addRadioOption" class=" btn btn-primary btn-sm" value="' + k + '"> <i class="fa fa-plus"></i></button> <br> <form action ="" class = "inputsRadio'+ k +'" id = "inputsRadio' + k +'"></div></div></a>').appendTo(forma);
            k++;
            return false;
    });

    $(document).on('click', '#addRadioOption', function(){
                var idRadio = $(this).attr('value'); 
                $('<input type="radio" id="radio' + j +'" size="20" name="radio" value=""/> Escolha<br>').appendTo(".inputsRadio"+idRadio);
                //$(".inputsRadio"+i).append('');
                 //<input type=\"Radio\" id=\"Radio' + i +'\" size=\"20\" name=\"Radio\" value=\"\" />
                 j++;
                return false;
            });
        
   $(document).on('click', '#removeRadio', function(){
            if( k > 0 ) {
                //$(this).parent().remove();
                //i--;
                var id = $(this).attr('value');
                $('#divRadio'+id).fadeOut(300, function(){ 
                    $(this).remove();
                });
           }
            return false;
    });    

});

</script>

    </body>
</html>
